<!DOCTYPE html>
<head lang="en">
	<meta charset="utf-8">
	<title>Facebook Messenger Bots for PHP Documentation</title>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

	<link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700,400italic' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/styles/default.min.css">

	<style type="text/css">
	body {font: 16px "Source Sans Pro", "Arial", sans-serif}
	strong {font-weight: bold}
	h1, h2, h3,h4,h5 {font: 48px "Source Sans Pro", "Arial", sans-serif; padding-bottom: 0.5em;}

	h1{
		margin: 30px 0;
	}
	h2 {font-size: 40px}
	h3 {font-size: 34px}
	h4 {font-size: 26px}
	h5 {font-size: 22px; font-weight: normal}
	h6{ font-size: 18px; }
	ul li{
		margin: 10px 0;
	}
	p {margin-bottom: 1em; line-height: 1.5em; text-align: justify}
	ul {list-style: disc; padding-left: 20px; margin: 1em 0}
	ol {list-style: decimal; padding-left: 20px}
	code { color: #52bb5d;}

	.container {width: 960px; margin: 30px auto}
	header, section, footer {display: block}
	
	img{
		display: block;
		clear: both;
		margin: 20px auto;
	}
	a{
		color: #f4645f;
	}
	header h1 {text-align: center}
	
	nav ul {overflow: hidden; margin-bottom: 20px; padding-left: 0}
	nav li {list-style: none; float: left; border-left: 1px solid #ccc; padding: 0 10px}
	nav li:first-child {border-left: none; padding-left: 0}

	#info strong {width: 120px; display: inline-block}
	.center{ text-align: center;}
	footer {margin: 15px auto; color: #999; font-size: 11px}
	hr{
		border-top: 1px solid #eee;
		border-bottom: none;
	}
    </style>
</head>


<body>
	<div class="container">
	
		<h1 class="center">Facebook Messenger Bots for PHP Documentation</h1>
		
		<div class="borderTop">
			<div class="span-6 colborder info prepend-1">
				<p class="prepend-top">
					<strong>
					Version: 2.0<br>
					By: Binaty<br>
					Email: <a href="mailto:hello@binaty.org">hello@binaty.org</a>
					</strong>
				</p>
			</div><!-- end div .span-6 -->		
	
			<div class="span-12 last">
				<p class="prepend-top append-0">Thank you for purchasing our library. If you have any questions that are beyond the scope of this help file, please feel free to email via contact form <a href="http://codecanyon/user/binaty">here</a>. <br>
				Thanks so much!</p>
			</div>
		</div><!-- end div .borderTop -->
		
		<hr>
		
		<h2 id="toc" class="alt">Table of Contents</h2>
		<ol>
			<li><a href="#update-guide">Upgrade Guide</a></li>
			<li><a href="#installation">Installation</a></li>
			<li><a href="#setup-facebook">Setup Facebook Page &amp; App</a></li>
			<li><a href="#design-a-bot">Defining a Bot</a></li>
			<li><a href="#uninstallation">Uninstallation</a></li>
			<li><a href="#change-logs">Change Logs</a></li>
		</ol>
		
		<hr>
		<h3 id="update-guide">1. Upgrade Guide</h3>

		<blockquote>We attempt to provide a very comprehensive listing of every possible breaking change made to the libary. However, many of these changes may not apply to your own application.</blockquote>

		<h4 id="1-to-2">Upgrade to 2.0 from 1.x</h5>

		<ul>
			<li>Remove your whole libary files and replace with new <code>2.x</code> files.</li>
			<li>Replace <code>MessengerBot</code> class with <code>FacebookMessengerBot.</code></li>
			<li>Go to <code>core/config.php</code> then enter your App's PAGE ACCESS TOKEN, PAGE ID to PAGE_ACCESS_TOKEN and PAGE_ID constants.</li>
			<li>If you use <code>BOT_DIR</code> constant, replace it with new <code>FMB_ABS_PATH</code> constant.</li>
		</ul>
		
		<hr>

		<h3 id="installation">2. Installation - <a href="#toc">top</a></h3>
        
        <p>It's recommended that you read <a href="https://developers.facebook.com/docs/messenger-platform/product-overview">Messenger Platform's Overview</a> before continue reading this documentation.</p>

        <h4>2.1 Server Requirements</h4>
		<p>
            Facebook Messenger Bots has tested and compatibility with
            <ul>
                <li>PHP 5.2+</li>
                <li><code>cURL</code> should enabled</li>
                <li>Your site (or webhook) should <code>https</code></li>
            </ul>
           
        </p>
		
		<h4>2.2 Installation</h4>
		
		<ol>
            <li>Download <code>facebook-messenger-bots.zip</code> and unzip the package.</li>
            <li>Copy or Upload <code>facebook-messenger-bots</code> folder to your desired directory. Should allows user access via <code>https</code></li>
            <li>Start design the bot directly in <code>index.php</code> or <code>examples/example.php</code></li>
        </ol>

		<h5>Local Development Environment</h5>
		<p>If you wanna test your bot on your existing local server before deploying but don't have SSL certificate. The easiest method is install a secure tunnel <code>ngrok</code>.</p>
		
		<ol>
			<li>Download <a href="https://ngrok.com/download">ngrok</a>. Available on all OS.</li>
			<li>Open ngrok, run <code>ngrok http 80</code> to make an alias of http server.</li>
			<li>Done. You'll get a random https domain (for example: <a href="https://2a3ffc77.ngrok.io/">https://2a3ffc77.ngrok.io/</a>) pointing to your <a href="http://localhost">http://localhost</a>. Copy it to your browser and enjoy.</li>
		</ol>

		<hr>

		<h3 id="setup-facebook">3. Setup Facebook Page &amp; App - <a href="#toc">top</a></h3>
        
        <h4>3.1 Register <a href="https://business.facebook.com/">Facebook Business Program</a></h4>

        <h4>3.2 Create Facebook App &amp; Page</h4>
		<p>Create a new <a href="https://developers.facebook.com/quickstarts/?platform=web">Facebook App</a> and <a href="https://www.facebook.com/pages/create">Page</a> or use existing ones. Your Facebook App can remain in sandbox mode and your Page does NOT have to be publicly visibile. The Page profile pic and name will be used to form the "identity" of your bot and is what people will see when they engage it.</p>	
		
		<h4>3.3 Setup Webhook</h4>
		<ul>
			<li>
				In your Facebook App. Navigate to Webhooks menu item, click New Subscription, then choose Page. A dialog will shows up
				
				<img src="https://facebookmessengerbots.com/images/new-page-subscription.jpg" alt="New Page Subscription" />
				
				<ul>
					<li>In "Callback URL", enter your webhook: <code>https://yourwebsite.com/messenger</code> replace <code>yourwebsite.com/messenger</code> with your webhook.</li>
					<li>In "Verify Token", enter <code>FacebookMessengerBots</code></li>
					<li>In "Subscription Field", check <code>message_deliveries</code>, <code>messages</code>, <code>messaging_optins</code>, and <code>messaging_postbacks</code></li>
					<li>Click "Verify and Save"</li>
				</ul>
			</li>
		</ul>
		<p class="description">If these above step success, you'll see this, and the verify checkbox in Facebook Messenger Bots settings is unchecked</p>
			<img src="https://facebookmessengerbots.com/images/webhook.jpg" alt="Webhook Success">

		<h4>3.4 Setup Messenger</h4>
		<p>The next step in this part is make a connection between Website <=> Facebook App <=> Page, so all messages come from page pass through app to website and vice versa</p>

		<ul>
			<li>In your Facebook App. Navigate Messenger, below Webhooks item.</li>
			<li>In <code>Token Generation</code> section, select a your page, you'll need to confirm permission for that page. After that step, you'll got Page Access Token.
				<img src="https://facebookmessengerbots.com/images/token-generation.jpg" alt="Page Access Token">
			</li>
			<li>Click to copy that token, open <code>core/config.php</code> and replace <code>{YOUR_PAGE_ACCESS_TOKEN}</code> with your copied token.</li>
			<li><em>(Optional)</em> Go to your FB page, jump to About tab, copy Facebook Page ID and replace <code>{YOUR_PAGE_ID} with your page id.</code>
				<img src="https://facebookmessengerbots.com/images/facebook-page-id.jpg" alt="Page ID">
			</li>
			<li>Click Save Changes</li>

			<li>Now, visit your webhook at <code>https://yourwebsite.com/webhook/subscribe.php</code>. If you see this screen, congratulation. Your bot is ready!
			<img src="https://facebookmessengerbots.com/images/subscribe-200.jpg" alt="Subscribe Success">

			Please remember that you can visit this subscribe URL anytime to check connection status.
			</li>
		</ul>

		<hr>
		<h3 id="design-a-bot">4. Defining a Bot <a href="#toc">top</a></h3>
        
        <h4>4.1 Messenger Greeting</h4>
        <p>Your greeting is what people will see the first time they open a conversation with you on Messenger. The greeting helps people understand how to interact with you.</p>
		
		<p>Go to Page Settings > Messaging tab. You can see many message settings here. Notice that you can customize Messenger Greeting section.</p>
		
		<img src="https://facebookmessengerbots.com/images/messaging.jpg" alt="Subscribe Success">

		<p class="description">If you have set it but can't see Messenger Greeting, don't worry. That's a <a href="https://developers.facebook.com/bugs/1728242210729502/?pnref=story">Facebook's bug</a> and they'll fix it soon.</p>
		
		<h4>4.2 Creating a Bot</h4>
		<blockquote>The easiest way to create a bot is edit <code>example.php</code> file. Of course, you can define bot in any file which you want. For example: <code>index.php</code></blockquote>
		
		<h5 id="create-a-bot-instance">Create a Bot instance</h5>
		
		The first step to create a bot is creating a bot instance. Just make a new instance of <code>FacebookMessengerBot</code>. This accepts 1 parameter which we'll let you know on the next part.
		<pre class="php">
			<code>
				$bot = new FacebookMessengerBot($answers);
			</code>
		</pre>
		
		<h5>Bot answers</h5>
		<p>Bot answers when users send a text, click on a button, or when users click "Get Started" bot answers with a welcome message. <br>
			To define bot answers. Just use <code>$bot->answers();</code> method. This accepts 1 or two params. Let's start with some example. 
		</p>

		<strong>Answer a Text Message</strong>
<pre class="php">
<code>
// Answer `what does the fox says?` question with a text message.
$bot->answers( 'what does the fox says?', 'Ding ding ding ding ding ding!' );
</code>
</pre>

		<strong>You can add up to 3 messages per answer by passing an array</strong>

<pre class="php"><code>
// Answer `Who are you?` question with 3 text message
$bot->answers( 'Who are you?', [
	'Guess what?',
	'I am the good cook'
	'I am the one who knocks'
] );
</code></pre>

		<strong>You can also add <code>buttons</code> <code>generic template</code> or <code>receipt</code> to your message. A message can contains up to 3 of these items</strong>

<pre class="php"><code>
// Answer `Who are you?` question with a text message and buttons.
$bot->answers( 'Who are you?', [
	'Guess what?',

	// To add buttons. Simply use `button` key. 
	'button' => [
		// Button CTA title
		'text' => 'I am the one of those guys',
		
		// Buttons array. Can contains up to 3 items.
		'buttons' => [

			// Button can be a web url
			[
				'type' => 'web_url',
				'url' => 'http://breakingbad.com',
				'title' => 'Jesse Pinkman'
			],

			// Or a postback payload
			[
				'type' => 'postback',
				'payload' => 'UserClickedButton',
				'title' => 'Heisenberg'
			]
		]
	]
] );
</code></pre>

		<strong>Multiple questions - answers</strong>
<pre class="php"><code>
// Multiple questions - answers can be defined in an array with key is the question and the value as the answer with the same syntax with the above examples.
$bot->answers([
	// Bot says: `Ding ding ding ding ding ding!` when user ask "What does the fox says"
	'What does the fox says?' => 'Ding ding ding ding ding ding!',
	
	// Bot says. `Guess what?` and send two buttons when user ask `Who are you?`
	'Who are you?' => [
		'Guess what?',
		'buttons' => [
			[
				'type' => 'web_url',
				'url' => 'http://breakingbad.com',
				'title' => 'Jesse Pinkman'
			],
			[
				'type' => 'postback',
				'payload' => 'UserClickedHeisenbergButton',
				'title' => 'Heisenberg'
			]
		]
	]
]);
</code></pre>
<p>Back to the <a href="#create-a-bot-instance">Create a bot instance</a> section. You can put multiple questions - answers to the class constructor's arguments</p>

		<strong>Answer payload postback</strong>
		<p>Back to the previous example. You have created a postback button. And you want to send a message to users when they clicked to <code>UserClickedHeisenbergButton</code> button. You can define it by using key<code>payload:PAYLOAD_NAME</code> syntax. Like so:</p>
<pre class="php"><code>
// Bot says `You got damned right!` when users click `Heisenberg` button 
$bot->answers('payload:UserClickedHeisenbergButton', 'You got damned right!');
</code></pre>

		<strong>Welcome Message</strong>
		<p>At the first time when people start a chat with you. There's a `Get Started` button which you can send a custom welcome message. To define it. Just define `welcome:` as the key. Like so:</p>

<pre class="php"><code>
// Bot says `Thank god, you are here` to welcome a user
$bot->answers('welcome:', 'Thank god, you are here');
</code></pre>
		
		<p>Of course, you can send any message type which you want</p>

		<div class="alert alert-warning">
			Note that you have to go to https://yourwebsite.com/yourwebhook?update_welcome
		</div>
		
		<strong>Default Message</strong>
		<p>Default message trigger when people click on unhandled buttons or sent an unhandled message. For example: people say: <em>'konichiwa toyota honda'</em> and bot don't understand, so you can set default message to response</p>

<pre class="php">
	<code>
// Bot answers with default message
$bot->answers("default:", "Sorry, I don't understand what you mean. Type `help` to continue");
	</code>
</pre>
		
		<div class="alert alert-info">
			For more information. See: <a href="https://developers.facebook.com/docs/messenger-platform/send-api-reference">Messenger Platform - Send API Reference</a>
		</div>

		<h3 id="change-logs"><strong>5. Change Logs - <a href="#toc">top</a></strong></h3>
		<strong>Version 1.0 - April 25, 2016</strong>
		<ul>
			<li>Initial Release</li>
		</ul>

		<footer>
            Copyright &copy; 2016 Binaty
            
		    <p><a href="#toc">Go To Table of Contents</a></p>
		</footer>
		<hr class="space">
	</div><!-- end div .container -->
	
	<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/highlight.min.js"></script>
	<script>hljs.initHighlightingOnLoad();</script>
</body>
</html>